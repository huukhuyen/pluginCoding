/*!
 * smoothState.js is jQuery plugin that progressively enhances
 * page loads to behave more like a single-page application.
 *
 * @author  Miguel Ángel Pérez   reachme@miguel-perez.com
 * @see     http://smoothstate.com
 *
 */
!function(a){"object"==typeof module&&"object"==typeof module.exports?a(require("jquery"),window,document):a(jQuery,window,document)}(function(q,j,f,d){if(!j.history.pushState){return q.fn.smoothState=function(){return this},void (q.fn.smoothState.options={})}if(!q.fn.smoothState){var b=q("html, body"),m=j.console,h={debug:!1,anchors:"a",hrefRegex:"",forms:"form",allowFormCaching:!1,repeatDelay:500,blacklist:".no-smoothState",prefetch:!1,prefetchOn:"mouseover touchstart",prefetchBlacklist:".no-prefetch",locationHeader:"X-SmoothState-Location",cacheLength:0,loadingClass:"is-loading",scroll:!0,alterRequest:function(a){return a},alterChangeState:function(a,c,i){return a},onBefore:function(a,c){},onStart:{duration:0,render:function(a){}},onProgress:{duration:0,render:function(a){}},onReady:{duration:0,render:function(a,c){a.html(c)}},onAfter:function(a,c){}},v={isExternal:function(a){var c=a.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);return"string"==typeof c[1]&&c[1].length>0&&c[1].toLowerCase()!==j.location.protocol?!0:"string"==typeof c[2]&&c[2].length>0&&c[2].replace(new RegExp(":("+{"http:":80,"https:":443}[j.location.protocol]+")?$"),"")!==j.location.host},stripHash:function(a){return a.replace(/#.*/,"")},isHash:function(a,i){i=i||j.location.href;var e=a.indexOf("#")>-1,c=v.stripHash(a)===v.stripHash(i);return e&&c},translate:function(a){var c={dataType:"html",type:"GET"};return a="string"==typeof a?q.extend({},c,{url:a}):q.extend({},c,a)},shouldLoadAnchor:function(a,i,l){var c=a.prop("href");return(v.isExternal(c)||v.isHash(c)||a.is(i)||a.prop("target")||typeof l!==d&&""!==l&&-1===a.prop("href").search(l))},clearIfOverCapacity:function(a,c){return Object.keys||(Object.keys=function(i){var l,o=[];for(l in i){Object.prototype.hasOwnProperty.call(i,l)&&o.push(l)}return o}),Object.keys(a).length>c&&(a={}),a},storePageIn:function(w,y,x,u,c,l){var t=q("<html></html>").append(q(x));return"undefined"==typeof c&&(c={}),"undefined"==typeof l&&(l=y),w[y]={status:"loaded",title:t.find("title").first().text(),html:t.find("#"+u),doc:x,state:c,destUrl:l},w},triggerAllAnimationEndEvent:function(y,A){A=" "+A||"";var z=0,x="animationstart webkitAnimationStart oanimationstart MSAnimationStart",s="animationend webkitAnimationEnd oanimationend MSAnimationEnd",w="allanimationend",c=function(a){q(a.delegateTarget).is(y)&&(a.stopPropagation(),z++)},t=function(a){q(a.delegateTarget).is(y)&&(a.stopPropagation(),z--,0===z&&y.trigger(w))};y.on(x,c),y.on(s,t),y.on("allanimationend"+A,function(){z=0,v.redraw(y)})},redraw:function(a){a.height()}},g=function(w){if(null!==w.state){var u=j.location.href,t=q("#"+w.state.id),e=t.data("smoothState"),s=e.href!==u&&!v.isHash(u,e.href),c=w.state!==e.cache[e.href].state;(s||c)&&(c&&e.clear(e.href),e.load(u,!1))}},p=function(L,K){var D=q(L),V=D.prop("id"),Q=null,U=!1,M={},I={},N=j.location.href,J=function(c){c=c||!1,c&&M.hasOwnProperty(c)?delete M[c]:M={},D.data("smoothState").cache=M},s=function(i,u){u=u||q.noop;var l=v.translate(i);if(M=v.clearIfOverCapacity(M,K.cacheLength),!M.hasOwnProperty(l.url)||"undefined"!=typeof l.data){M[l.url]={status:"fetching"};var c=q.ajax(l);c.done(function(w){v.storePageIn(M,l.url,w,V),D.data("smoothState").cache=M}),c.fail(function(){M[l.url].status="error"}),K.locationHeader&&c.always(function(x,A,C){var y=x.statusCode?x:C,w=y.getResponseHeader(K.locationHeader);w&&(M[l.url].destUrl=w)}),u&&c.always(u)}},B=function(){if(Q){var c=q(Q,D);if(c.length){var i=c.offset().top;b.scrollTop(i)}Q=null}},e=function(u){var c="#"+V,l=M[u]?q(M[u].html.html()):null;l.length?(f.title=M[u].title,D.data("smoothState").href=u,K.loadingClass&&b.removeClass(K.loadingClass),K.onReady.render(D,l),D.one("ss.onReadyEnd",function(){U=!1,K.onAfter(D,l),K.scroll&&B(),r(D)}),j.setTimeout(function(){D.trigger("ss.onReadyEnd")},K.onReady.duration)):!l&&K.debug&&m?m.warn("No element with an id of "+c+" in response from "+u+" in "+M):j.location=u},z=function(l,A,y){var c=v.translate(l);"undefined"==typeof A&&(A=!0),"undefined"==typeof y&&(y=!0);var w=!1,x=!1,u={loaded:function(){var i=w?"ss.onProgressEnd":"ss.onStartEnd";if(x&&w?x&&e(c.url):D.one(i,function(){e(c.url),y||J(c.url)}),A){var C=M[c.url].destUrl;I=K.alterChangeState({id:V},M[c.url].title,C),M[c.url].state=I,j.history.pushState(I,M[c.url].title,C)}x&&!y&&J(c.url)},fetching:function(){w||(w=!0,D.one("ss.onStartEnd",function(){K.loadingClass&&b.addClass(K.loadingClass),K.onProgress.render(D),j.setTimeout(function(){D.trigger("ss.onProgressEnd"),x=!0},K.onProgress.duration)})),j.setTimeout(function(){M.hasOwnProperty(c.url)&&u[M[c.url].status]()},10)},error:function(){K.debug&&m?m.log("There was an error loading: "+c.url):j.location=c.url}};M.hasOwnProperty(c.url)||s(c),K.onStart.render(D),j.setTimeout(function(){K.scroll&&b.scrollTop(0),D.trigger("ss.onStartEnd")},K.onStart.duration),u[M[c.url].status]()},F=function(c){var l,i=q(c.currentTarget);v.shouldLoadAnchor(i,K.blacklist,K.hrefRegex)&&!U&&(c.stopPropagation(),l=v.translate(i.prop("href")),l=K.alterRequest(l),s(l))},W=function(c){var l=q(c.currentTarget);if(!c.metaKey&&!c.ctrlKey&&v.shouldLoadAnchor(l,K.blacklist,K.hrefRegex)&&(c.stopPropagation(),c.preventDefault(),!a())){H();var i=v.translate(l.prop("href"));U=!0,Q=l.prop("hash"),i=K.alterRequest(i),K.onBefore(l,D),z(i)}},G=function(i){var l=q(i.currentTarget);if(!l.is(K.blacklist)&&(i.preventDefault(),i.stopPropagation(),!a())){H();var c={url:l.prop("action"),data:l.serialize(),type:l.prop("method")};U=!0,c=K.alterRequest(c),"get"===c.type.toLowerCase()&&(c.url=c.url+"?"+c.data),K.onBefore(l,D),z(c,d,K.allowFormCaching)}},o=0,a=function(){var c=null===K.repeatDelay,i=parseInt(Date.now())>o;return !(c||i)},H=function(){o=parseInt(Date.now())+parseInt(K.repeatDelay)},r=function(c){K.anchors&&K.prefetch&&c.find(K.anchors).not(K.prefetchBlacklist).on(K.prefetchOn,null,F)},n=function(c){K.anchors&&(c.on("click",K.anchors,W),r(c)),K.forms&&c.on("submit",K.forms,G)},t=function(){var c=D.prop("class");D.removeClass(c),v.redraw(D),D.addClass(c)};return K=q.extend({},q.fn.smoothState.options,K),null===j.history.state?(I=K.alterChangeState({id:V},f.title,N),j.history.replaceState(I,f.title,N)):I={},v.storePageIn(M,N,f.documentElement.outerHTML,V,I),v.triggerAllAnimationEndEvent(D,"ss.onStartEnd ss.onProgressEnd ss.onEndEnd"),n(D),{href:N,cache:M,clear:J,load:z,fetch:s,restartCSSAnimations:t}},k=function(a){return this.each(function(){var c=this.tagName.toLowerCase();this.id&&"body"!==c&&"html"!==c&&!q.data(this,"smoothState")?q.data(this,"smoothState",new p(this,a)):!this.id&&m?m.warn("Every smoothState container needs an id but the following one does not have one:",this):"body"!==c&&"html"!==c||!m||m.warn("The smoothstate container cannot be the "+this.tagName+" tag")})};j.onpopstate=g,q.smoothStateUtility=v,q.fn.smoothState=k,q.fn.smoothState.options=h}});